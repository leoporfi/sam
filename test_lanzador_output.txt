============================= test session starts =============================
platform win32 -- Python 3.10.11, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\lporfiri\RPA\sam\.venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\lporfiri\RPA\sam
configfile: pyproject.toml
plugins: anyio-4.12.0, asyncio-1.3.0, cov-7.0.0, mock-3.15.1
asyncio: mode=auto, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 3 items

tests/test_lanzador.py::test_desplegador_deploys_pending_robot FAILED    [ 33%]
tests/test_lanzador.py::test_desplegador_handles_no_robots_to_deploy FAILED [ 66%]
tests/test_lanzador.py::test_sincronizador_updates_running_deployment FAILED [100%]

================================== FAILURES ===================================
___________________ test_desplegador_deploys_pending_robot ____________________

mock_db_connector = <MagicMock id='2335065539824'>

    async def test_desplegador_deploys_pending_robot(mock_db_connector):
        """
        Verifica que el Desplegador intenta lanzar un robot que estÃŸ pendiente.
        """
        # 1. Arrange: Preparamos el escenario de la prueba
        mock_robot_pendiente = (1, "TestBot", None, "PENDIENTE", None)
        mock_db_connector.fetch_one.return_value = mock_robot_pendiente

        mock_a360_client = AsyncMock(spec=AutomationAnywhereClient)
>       mock_a360_client.deploy_bot.return_value = {"deploymentId": "test-deployment-123"}

tests\test_lanzador.py:26:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <AsyncMock spec='AutomationAnywhereClient' id='2335065792064'>
name = 'deploy_bot'

    def __getattr__(self, name):
        if name in {'_mock_methods', '_mock_unsafe'}:
            raise AttributeError(name)
        elif self._mock_methods is not None:
            if name not in self._mock_methods or name in _all_magics:
>               raise AttributeError("Mock object has no attribute %r" % name)
E               AttributeError: Mock object has no attribute 'deploy_bot'

..\..\AppData\Local\Programs\Python\Python310\lib\unittest\mock.py:643: AttributeError
---------------------------- Captured stderr setup ----------------------------
CONFIG_LOADER: Cargando .env general desde C:\Users\lporfiri\RPA\sam\.env
CONFIG_LOADER: Servicio 'sam_test_session' inicializado
CONFIG_LOADER: Proyecto root: C:\Users\lporfiri\RPA\sam
________________ test_desplegador_handles_no_robots_to_deploy _________________

mock_db_connector = <MagicMock id='2335065800080'>

    async def test_desplegador_handles_no_robots_to_deploy(mock_db_connector):
        """
        Verifica que el Desplegador no hace nada si no hay robots pendientes.
        """
        # Arrange
        mock_db_connector.fetch_one.return_value = None
        mock_a360_client = AsyncMock(spec=AutomationAnywhereClient)
>       desplegador = Desplegador(db_connector=mock_db_connector, a360_client=mock_a360_client)
E       TypeError: Desplegador.__init__() got an unexpected keyword argument 'a360_client'

tests\test_lanzador.py:46: TypeError
________________ test_sincronizador_updates_running_deployment ________________

mock_db_connector = <MagicMock id='2335075086688'>

    async def test_sincronizador_updates_running_deployment(mock_db_connector):
        """
        Verifica que el Sincronizador actualiza el estado de un robot 'EN_CURSO'.
        """
        # Arrange
        mock_robot_en_curso = (1, "TestBot", "dep-123", "EN_CURSO", None)
        mock_db_connector.fetch_all.return_value = [mock_robot_en_curso]

        mock_a360_client = AsyncMock(spec=AutomationAnywhereClient)
>       mock_a360_client.get_deployment_status.return_value = {"status": "COMPLETED"}

tests\test_lanzador.py:64:
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <AsyncMock spec='AutomationAnywhereClient' id='2335075244384'>
name = 'get_deployment_status'

    def __getattr__(self, name):
        if name in {'_mock_methods', '_mock_unsafe'}:
            raise AttributeError(name)
        elif self._mock_methods is not None:
            if name not in self._mock_methods or name in _all_magics:
>               raise AttributeError("Mock object has no attribute %r" % name)
E               AttributeError: Mock object has no attribute 'get_deployment_status'

..\..\AppData\Local\Programs\Python\Python310\lib\unittest\mock.py:643: AttributeError
=============================== tests coverage ================================
______________ coverage: platform win32, python 3.10.11-final-0 _______________

Name                                                                                  Stmts   Miss  Cover   Missing
-------------------------------------------------------------------------------------------------------------------
src\sam\__init__.py                                                                       1      0   100%
src\sam\balanceador\__init__.py                                                           0      0   100%
src\sam\balanceador\__main__.py                                                           5      5     0%   6-12
src\sam\balanceador\run_balanceador.py                                                   89     89     0%   7-168
src\sam\balanceador\service\__init__.py                                                   0      0   100%
src\sam\balanceador\service\algoritmo_balanceo.py                                       238    238     0%   4-454
src\sam\balanceador\service\clouders_client.py                                           41     41     0%   2-78
src\sam\balanceador\service\cooling_manager.py                                           41     41     0%   3-100
src\sam\balanceador\service\historico_client.py                                          24     24     0%   3-79
src\sam\balanceador\service\main.py                                                      85     85     0%   3-138
src\sam\balanceador\service\proveedores.py                                              104    104     0%   2-186
src\sam\callback\__init__.py                                                              0      0   100%
src\sam\callback\__main__.py                                                              5      5     0%   6-12
src\sam\callback\run_callback.py                                                         72     72     0%   6-135
src\sam\callback\service\__init__.py                                                      0      0   100%
src\sam\callback\service\main.py                                                         84     84     0%   4-203
src\sam\common\__init__.py                                                                0      0   100%
src\sam\common\a360_client.py                                                           260    222    15%   27-44, 48-49, 55-106, 110-113, 120-177, 183-201, 205, 222-226, 229-232, 235-258, 262-283, 290-312, 322-331, 341-351, 355-369, 373-380, 384-404, 408-410, 414-418
src\sam\common\alert_types.py                                                            31      0   100%
src\sam\common\apigw_client.py                                                           79     64    19%   19-39, 46-76, 80, 87-96, 102-109, 122-145, 149-151
src\sam\common\config_loader.py                                                          52     15    71%   25, 35, 38-41, 69-71, 79-81, 86, 91-94
src\sam\common\config_manager.py                                                        146     99    32%   15-20, 41, 53-82, 90-96, 103, 135-141, 154, 175-193, 218, 234, 249, 265-281, 290-302, 307, 316, 329, 344, 365-415
src\sam\common\database.py                                                              204    172    16%   30-48, 51-83, 86-96, 100-119, 122-131, 134-140, 143-150, 153-180, 190-216, 228-243, 246, 251-256, 259, 273-308, 311-323, 326-347
src\sam\common\logging_setup.py                                                          33     33     0%   2-72
src\sam\common\mail_client.py                                                           132    115    13%   22-56, 60-138, 145-198, 202-216, 278-285, 288-295
src\sam\common\sincronizador_comun.py                                                    56     46    18%   26-28, 35-59, 66-119
src\sam\lanzador\__init__.py                                                              0      0   100%
src\sam\lanzador\__main__.py                                                              5      5     0%   6-12
src\sam\lanzador\run_lanzador.py                                                        147    147     0%   7-272
src\sam\lanzador\service\__init__.py                                                      0      0   100%
src\sam\lanzador\service\conciliador.py                                                 155    155     0%   2-357
src\sam\lanzador\service\desplegador.py                                                 396    370     7%   46-72, 84-144, 151-172, 181-833, 843-860, 864-879, 885-890, 897-905, 912-925, 931-945, 949-956, 963-1013
src\sam\lanzador\service\main.py                                                        114    114     0%   2-283
src\sam\lanzador\service\sincronizador.py                                                15      7    53%   21, 28-34
src\sam\web\__init__.py                                                                   0      0   100%
src\sam\web\__main__.py                                                                   5      5     0%   6-13
src\sam\web\backend\__init__.py                                                           0      0   100%
src\sam\web\backend\api.py                                                              601    601     0%   3-1418
src\sam\web\backend\cache.py                                                            107    107     0%   8-219
src\sam\web\backend\database.py                                                         519    519     0%   2-1244
src\sam\web\backend\dependencies.py                                                      38     38     0%   2-70
src\sam\web\backend\docs_data.py                                                          3      3     0%   8-405
src\sam\web\backend\schemas.py                                                          122    122     0%   1-172
src\sam\web\frontend\__init__.py                                                          0      0   100%
src\sam\web\frontend\api\__init__.py                                                      2      2     0%   4-6
src\sam\web\frontend\api\api_client.py                                                  170    170     0%   22-395
src\sam\web\frontend\app.py                                                             315    315     0%   2-840
src\sam\web\frontend\features\__init__.py                                                 0      0   100%
src\sam\web\frontend\features\components\__init__.py                                      0      0   100%
src\sam\web\frontend\features\components\analytics\__init__.py                            9      9     0%   2-11
src\sam\web\frontend\features\components\analytics\analytics_summary.py                 134    134     0%   1-261
src\sam\web\frontend\features\components\analytics\balanceador_dashboard.py              78     78     0%   3-124
src\sam\web\frontend\features\components\analytics\callbacks_dashboard.py                73     73     0%   3-117
src\sam\web\frontend\features\components\analytics\chart_components.py                   46     46     0%   7-282
src\sam\web\frontend\features\components\analytics\patrones_temporales_dashboard.py     125    125     0%   3-284
src\sam\web\frontend\features\components\analytics\status_dashboard.py                  145    145     0%   3-240
src\sam\web\frontend\features\components\analytics\tasas_exito_dashboard.py              76     76     0%   3-128
src\sam\web\frontend\features\components\analytics\tiempos_ejecucion_dashboard.py        62     62     0%   4-107
src\sam\web\frontend\features\components\analytics\utilizacion_dashboard.py              56     56     0%   3-102
src\sam\web\frontend\features\components\bot_input_editor.py                            123    123     0%   7-252
src\sam\web\frontend\features\components\config_page.py                                  23     23     0%   2-47
src\sam\web\frontend\features\components\docs_faq.py                                     44     44     0%   7-123
src\sam\web\frontend\features\components\docs_glossary.py                                44     44     0%   7-125
src\sam\web\frontend\features\components\equipo_list.py                                  69     69     0%   9-372
src\sam\web\frontend\features\components\mappings_page.py                                72     72     0%   2-115
src\sam\web\frontend\features\components\pool_list.py                                    86     86     0%   9-301
src\sam\web\frontend\features\components\robot_list.py                                   84     84     0%   9-365
src\sam\web\frontend\features\components\schedule_list.py                                38     38     0%   9-324
src\sam\web\frontend\features\modals\__init__.py                                          0      0   100%
src\sam\web\frontend\features\modals\config_modals.py                                    26     26     0%   2-45
src\sam\web\frontend\features\modals\equipos_modals.py                                   75     75     0%   2-142
src\sam\web\frontend\features\modals\pool_modals.py                                     124    124     0%   2-337
src\sam\web\frontend\features\modals\robots_modals.py                                   444    444     0%   2-1703
src\sam\web\frontend\features\modals\schedule_create_modal.py                            95     95     0%   9-568
src\sam\web\frontend\features\modals\schedule_modal.py                                  227    227     0%   1-895
src\sam\web\frontend\hooks\__init__.py                                                    0      0   100%
src\sam\web\frontend\hooks\use_config_hook.py                                            41     41     0%   2-55
src\sam\web\frontend\hooks\use_debounced_value_hook.py                                   38     38     0%   2-69
src\sam\web\frontend\hooks\use_equipos_hook.py                                          158    158     0%   9-255
src\sam\web\frontend\hooks\use_pools_hook.py                                             82     82     0%   9-142
src\sam\web\frontend\hooks\use_robots_hook.py                                           153    153     0%   9-272
src\sam\web\frontend\hooks\use_safe_state.py                                             10     10     0%   2-17
src\sam\web\frontend\hooks\use_schedules_hook.py                                        153    153     0%   9-259
src\sam\web\frontend\shared\__init__.py                                                   5      5     0%   4-54
src\sam\web\frontend\shared\async_content.py                                             48     48     0%   20-215
src\sam\web\frontend\shared\common_components.py                                         92     92     0%   2-461
src\sam\web\frontend\shared\data_table.py                                                64     64     0%   25-240
src\sam\web\frontend\shared\docs_components.py                                           38     38     0%   7-187
src\sam\web\frontend\shared\formatters.py                                                88     88     0%   9-192
src\sam\web\frontend\shared\notifications.py                                             39     39     0%   1-95
src\sam\web\frontend\shared\styles.py                                                    43     43     0%   22-101
src\sam\web\frontend\state\__init__.py                                                    2      2     0%   4-6
src\sam\web\frontend\state\app_context.py                                                 5      5     0%   24-47
src\sam\web\frontend\utils\__init__.py                                                    5      5     0%   4-21
src\sam\web\frontend\utils\exceptions.py                                                 17     17     0%   2-28
src\sam\web\frontend\utils\filtering.py                                                  75     75     0%   16-274
src\sam\web\frontend\utils\input_helpers.py                                              17     17     0%   7-54
src\sam\web\frontend\utils\validation.py                                                 16     16     0%   2-31
src\sam\web\main.py                                                                      45     45     0%   2-79
src\sam\web\run_web.py                                                                  102    102     0%   6-205
-------------------------------------------------------------------------------------------------------------------
TOTAL                                                                                  8210   7948     3%
=========================== short test summary info ===========================
FAILED tests/test_lanzador.py::test_desplegador_deploys_pending_robot - AttributeError: Mock object has no attribute 'deploy_bot'
FAILED tests/test_lanzador.py::test_desplegador_handles_no_robots_to_deploy - TypeError: Desplegador.__init__() got an unexpected keyword argument 'a360_client'
FAILED tests/test_lanzador.py::test_sincronizador_updates_running_deployment - AttributeError: Mock object has no attribute 'get_deployment_status'
============================== 3 failed in 3.75s ==============================

============================= test session starts =============================
platform win32 -- Python 3.10.11, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\lporfiri\RPA\sam\.venv\Scripts\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\lporfiri\RPA\sam
configfile: pyproject.toml
plugins: anyio-4.12.0, asyncio-1.3.0, cov-7.0.0, mock-3.15.1
asyncio: mode=auto, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 3 items

tests/test_web.py::TestWebAPIEndpoints::test_get_robots_endpoint FAILED  [ 33%]
tests/test_web.py::TestWebAPIEndpoints::test_update_robot_status_endpoint PASSED [ 66%]
tests/test_web.py::TestWebAPIEndpoints::test_update_robot_status_not_found PASSED [100%]

================================== FAILURES ===================================
________________ TestWebAPIEndpoints.test_get_robots_endpoint _________________

self = <tests.test_web.TestWebAPIEndpoints object at 0x00000227A02A6BC0>
client = <starlette.testclient.TestClient object at 0x00000227A1392E90>
mock_db_connector = <MagicMock id='2369231163008'>

    def test_get_robots_endpoint(self, client: TestClient, mock_db_connector):
        """Verifica que el endpoint para obtener robots funciona correctamente."""
        mock_db_connector.ejecutar_consulta.side_effect = [
            [{"total_count": 1}],
            [{"RobotId": 1, "Robot": "TestBot", "Activo": True, "EsOnline": False}],
        ]
        response = client.get("/api/robots", params={"page": 1, "size": 10})
        assert response.status_code == 200
        data = response.json()
>       assert data["total_count"] == 1
E       assert 0 == 1

tests\test_web.py:43: AssertionError
---------------------------- Captured stderr setup ----------------------------
CONFIG_LOADER: Cargando .env general desde C:\Users\lporfiri\RPA\sam\.env
CONFIG_LOADER: Servicio 'sam_test_session' inicializado
CONFIG_LOADER: Proyecto root: C:\Users\lporfiri\RPA\sam
============================== warnings summary ===============================
src\sam\web\backend\api.py:37
  C:\Users\lporfiri\RPA\sam\src\sam\web\backend\api.py:37: DeprecationWarning:
          on_event is deprecated, use lifespan event handlers instead.

          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).

    @router.on_event("startup")

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=============================== tests coverage ================================
______________ coverage: platform win32, python 3.10.11-final-0 _______________

Name                                                                                  Stmts   Miss  Cover   Missing
-------------------------------------------------------------------------------------------------------------------
src\sam\__init__.py                                                                       1      0   100%
src\sam\balanceador\__init__.py                                                           0      0   100%
src\sam\balanceador\__main__.py                                                           5      5     0%   6-12
src\sam\balanceador\run_balanceador.py                                                   89     89     0%   7-168
src\sam\balanceador\service\__init__.py                                                   0      0   100%
src\sam\balanceador\service\algoritmo_balanceo.py                                       238    238     0%   4-454
src\sam\balanceador\service\clouders_client.py                                           41     41     0%   2-78
src\sam\balanceador\service\cooling_manager.py                                           41     41     0%   3-100
src\sam\balanceador\service\historico_client.py                                          24     24     0%   3-79
src\sam\balanceador\service\main.py                                                      85     85     0%   3-138
src\sam\balanceador\service\proveedores.py                                              104    104     0%   2-186
src\sam\callback\__init__.py                                                              0      0   100%
src\sam\callback\__main__.py                                                              5      5     0%   6-12
src\sam\callback\run_callback.py                                                         72     72     0%   6-135
src\sam\callback\service\__init__.py                                                      0      0   100%
src\sam\callback\service\main.py                                                         84     84     0%   4-203
src\sam\common\__init__.py                                                                0      0   100%
src\sam\common\a360_client.py                                                           260    222    15%   27-44, 48-49, 55-106, 110-113, 120-177, 183-201, 205, 222-226, 229-232, 235-258, 262-283, 290-312, 322-331, 341-351, 355-369, 373-380, 384-404, 408-410, 414-418
src\sam\common\alert_types.py                                                            31     31     0%   1-51
src\sam\common\apigw_client.py                                                           79     64    19%   19-39, 46-76, 80, 87-96, 102-109, 122-145, 149-151
src\sam\common\config_loader.py                                                          52     15    71%   25, 35, 38-41, 69-71, 79-81, 86, 91-94
src\sam\common\config_manager.py                                                        146     97    34%   15-20, 53-82, 90-96, 103, 135-141, 175-193, 218, 234, 249, 265-281, 290-302, 307, 316, 329, 344, 365-415
src\sam\common\database.py                                                              204    162    21%   51-83, 86-96, 100-119, 122-131, 134-140, 143-150, 153-180, 190-216, 228-243, 246, 251-256, 259, 273-308, 311-323, 326-347
src\sam\common\logging_setup.py                                                          33     33     0%   2-72
src\sam\common\mail_client.py                                                           132    132     0%   2-295
src\sam\common\sincronizador_comun.py                                                    56     46    18%   26-28, 35-59, 66-119
src\sam\lanzador\__init__.py                                                              0      0   100%
src\sam\lanzador\__main__.py                                                              5      5     0%   6-12
src\sam\lanzador\run_lanzador.py                                                        147    147     0%   7-272
src\sam\lanzador\service\__init__.py                                                      0      0   100%
src\sam\lanzador\service\conciliador.py                                                 155    155     0%   2-357
src\sam\lanzador\service\desplegador.py                                                 396    396     0%   2-1013
src\sam\lanzador\service\main.py                                                        114    114     0%   2-283
src\sam\lanzador\service\sincronizador.py                                                15     15     0%   2-34
src\sam\web\__init__.py                                                                   0      0   100%
src\sam\web\__main__.py                                                                   5      5     0%   6-13
src\sam\web\backend\__init__.py                                                           0      0   100%
src\sam\web\backend\api.py                                                              601    446    26%   61-62, 67-69, 78-92, 97-106, 120-141, 152-171, 178, 205-206, 220-232, 249, 266-283, 299-321, 336-353, 364, 380, 396-401, 407-411, 425-454, 467-483, 508-545, 564-590, 610-673, 691-700, 713-722, 735-744, 757, 773, 776-779, 786-802, 807-821, 829-832, 846-851, 856-859, 866-877, 882-896, 901-915, 926-941, 955-966, 971-974, 981-993, 1006-1009, 1020-1036, 1042-1058, 1066-1069, 1076-1092, 1100-1105, 1110-1128, 1135-1149, 1154-1165, 1170-1174, 1181-1193, 1201-1206, 1213-1226, 1231-1236, 1243-1257, 1265-1268, 1273-1285, 1290-1302, 1311-1313, 1319-1321, 1327-1334, 1340-1342, 1348-1355, 1366-1373, 1381-1418
src\sam\web\backend\cache.py                                                            107     75    30%   21-23, 27, 39-50, 54-56, 60-63, 67-69, 73, 108-124, 129-164, 168, 183-204, 209, 214, 219
src\sam\web\backend\database.py                                                         519    440    15%   38-39, 47-59, 66-79, 86-120, 129, 163-165, 177-182, 189-200, 207-225, 230-235, 244-260, 279-287, 294-295, 308-326, 330-334, 339-344, 348-353, 358-359, 363-406, 414-481, 490-547, 562-581, 588-589, 597-609, 617-635, 640-644, 648-659, 663-668, 672-676, 680-695, 699-702, 717-741, 749-751, 756-757, 765, 770-771, 778, 786-823, 833-881, 894-903, 920-930, 966-988, 1002-1015, 1033-1111, 1123-1131, 1144-1154, 1168-1195, 1210-1220, 1228-1244
src\sam\web\backend\dependencies.py                                                      38      6    84%   29, 47, 61, 64-66
src\sam\web\backend\docs_data.py                                                          3      3     0%   8-405
src\sam\web\backend\schemas.py                                                          122      0   100%
src\sam\web\frontend\__init__.py                                                          0      0   100%
src\sam\web\frontend\api\__init__.py                                                      2      0   100%
src\sam\web\frontend\api\api_client.py                                                  170    108    36%   36-37, 40-43, 46-47, 50-55, 66-87, 107, 123, 139, 154, 158-165, 168-171, 174-177, 180, 183, 187, 190, 193-194, 201-214, 220-221, 224, 227, 230, 233, 239, 246, 249, 258, 265, 269, 272, 275, 278, 281, 285-286, 289, 292, 298, 303, 307, 311, 315, 320, 325, 328, 331, 335, 338, 341, 346, 350, 353-355, 384-391
src\sam\web\frontend\app.py                                                             315    271    14%   61-157, 198-266, 310-368, 390-549, 651-709, 743-746, 767-801, 832-833
src\sam\web\frontend\features\__init__.py                                                 0      0   100%
src\sam\web\frontend\features\components\__init__.py                                      0      0   100%
src\sam\web\frontend\features\components\analytics\__init__.py                            9      0   100%
src\sam\web\frontend\features\components\analytics\analytics_summary.py                 134    126     6%   19-261
src\sam\web\frontend\features\components\analytics\balanceador_dashboard.py              78     67    14%   21-124
src\sam\web\frontend\features\components\analytics\callbacks_dashboard.py                73     61    16%   22-117
src\sam\web\frontend\features\components\analytics\chart_components.py                   46     35    24%   15, 20-24, 96-119, 150-170, 200-282
src\sam\web\frontend\features\components\analytics\patrones_temporales_dashboard.py     125    114     9%   20-284
src\sam\web\frontend\features\components\analytics\status_dashboard.py                  145    136     6%   18-240
src\sam\web\frontend\features\components\analytics\tasas_exito_dashboard.py              76     65    14%   21-128
src\sam\web\frontend\features\components\analytics\tiempos_ejecucion_dashboard.py        62     51    18%   22-107
src\sam\web\frontend\features\components\analytics\utilizacion_dashboard.py              56     45    20%   21-102
src\sam\web\frontend\features\components\bot_input_editor.py                            123    112     9%   52-61, 68-74, 82-94, 101-108, 121-252
src\sam\web\frontend\features\components\config_page.py                                  23     14    39%   16-47
src\sam\web\frontend\features\components\docs_faq.py                                     44     37    16%   26-123
src\sam\web\frontend\features\components\docs_glossary.py                                44     37    16%   26-125
src\sam\web\frontend\features\components\equipo_list.py                                  69     52    25%   47-50, 108-121, 155-178, 215-238, 252-279, 346-372
src\sam\web\frontend\features\components\mappings_page.py                                72     60    17%   22-115
src\sam\web\frontend\features\components\pool_list.py                                    86     66    23%   45-48, 89-92, 118, 144, 189, 217-301
src\sam\web\frontend\features\components\robot_list.py                                   84     68    19%   53-57, 120-140, 175-203, 224-255, 334-365
src\sam\web\frontend\features\components\schedule_list.py                                38     20    47%   36-44, 64-72, 156-161, 200-203, 323-324
src\sam\web\frontend\features\modals\__init__.py                                          0      0   100%
src\sam\web\frontend\features\modals\config_modals.py                                    26     22    15%   15-45
src\sam\web\frontend\features\modals\equipos_modals.py                                   75     66    12%   35-142
src\sam\web\frontend\features\modals\pool_modals.py                                     124    110    11%   16-55, 117-184, 263-269, 312-337
src\sam\web\frontend\features\modals\robots_modals.py                                   444    413     7%   74-90, 125-213, 495-644, 749-940, 1013-1106, 1191-1258, 1287-1309, 1497-1669, 1674-1703
src\sam\web\frontend\features\modals\schedule_create_modal.py                            95     85    11%   19-21, 29-75, 466-568
src\sam\web\frontend\features\modals\schedule_modal.py                                  227    211     7%   13-17, 31-69, 425-566, 638-697, 791-895
src\sam\web\frontend\hooks\__init__.py                                                    0      0   100%
src\sam\web\frontend\hooks\use_config_hook.py                                            41     34    17%   14-55
src\sam\web\frontend\hooks\use_debounced_value_hook.py                                   38     38     0%   2-69
src\sam\web\frontend\hooks\use_equipos_hook.py                                          158    147     7%   55-255
src\sam\web\frontend\hooks\use_pools_hook.py                                             82     75     9%   43-142
src\sam\web\frontend\hooks\use_robots_hook.py                                           153    142     7%   61-272
src\sam\web\frontend\hooks\use_safe_state.py                                             10     10     0%   2-17
src\sam\web\frontend\hooks\use_schedules_hook.py                                        153    143     7%   52-259
src\sam\web\frontend\shared\__init__.py                                                   5      0   100%
src\sam\web\frontend\shared\async_content.py                                             48     30    38%   55-83, 94-96, 110-113, 142, 161, 167, 196, 215
src\sam\web\frontend\shared\common_components.py                                         92     66    28%   25-62, 127-133, 149-161, 185-188, 234-237, 258, 283-298, 339, 435-441, 461
src\sam\web\frontend\shared\data_table.py                                                64     57    11%   72, 108-193, 214-240
src\sam\web\frontend\shared\docs_components.py                                           38     25    34%   21, 48-69, 82, 102, 123-125, 185-187
src\sam\web\frontend\shared\formatters.py                                                88     82     7%   24-27, 54-83, 99-164, 174-192
src\sam\web\frontend\shared\notifications.py                                             39     30    23%   17-55, 78-82, 88-95
src\sam\web\frontend\shared\styles.py                                                    43      0   100%
src\sam\web\frontend\state\__init__.py                                                    2      0   100%
src\sam\web\frontend\state\app_context.py                                                 5      1    80%   47
src\sam\web\frontend\utils\__init__.py                                                    5      0   100%
src\sam\web\frontend\utils\exceptions.py                                                 17     10    41%   9-11, 14-16, 23-25, 28
src\sam\web\frontend\utils\filtering.py                                                  75     63    16%   30-32, 51-59, 73-77, 100-108, 122-126, 144-146, 160-162, 176-178, 192-196, 224-245, 260-274
src\sam\web\frontend\utils\input_helpers.py                                              17     14    18%   20-25, 40-54
src\sam\web\frontend\utils\validation.py                                                 16     11    31%   15-31
src\sam\web\main.py                                                                      45      3    93%   37, 55-56
src\sam\web\run_web.py                                                                  102    102     0%   6-205
-------------------------------------------------------------------------------------------------------------------
TOTAL                                                                                  8210   6932    16%
=========================== short test summary info ===========================
FAILED tests/test_web.py::TestWebAPIEndpoints::test_get_robots_endpoint - assert 0 == 1
=================== 1 failed, 2 passed, 1 warning in 6.31s ====================
